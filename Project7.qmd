---
title: "Group 11 Analysis"
number-sections: true
format: 
  html:
    embed-resources: true
    code-tools: true
  pdf: default
editor_options: 
  chunk_output_type: console
---

```{r}
#| echo: false
#| warning: false
#| message: false
library(ggplot2)
library(tidyverse)
library(gt)
library(patchwork)
library(gridExtra)
library(knitr)
library(kableExtra)
library(dplyr)
library(broom)
library(MASS)
library(gt)
library(caret)
library(ResourceSelection)
library(pROC)
library(car)
```
# Introduction{#sec-intro}
Obesity is a significant public health concern, influenced by various socio-economic and lifestyle factors. This analysis uses data from the 2008-2012 Scottish Health Surveys to explore the relationship between demographic variables, lifestyle habits, and obesity prevalence in Scotland. The dataset includes information on age, gender, employment, dietary habits, and obesity status.
The objective is to examine trends in obesity prevalence over the survey years and identify differences in obesity rates based on socio-economic and lifestyle factors. The findings will inform public health strategies aimed at addressing obesity.
@sec-eda provides an exploratory analysis of the dataset, including trends in obesity across different groups. @sec-fda presents the results of a regression analysis, including model diagnostics to assess the model's fit and assumptions. Concluding remarks are in @sec-con.

# Exploratory data analysis {#sec-eda}
## Distribution of each variable
@fig-variable-distribution illustrates the distribution of key categorical variables in the dataset, including Age Group, Employment Status, Vegetable and Fruit Consumption, and Sex. Age Group (AgeGroup) distribution indicates that middle-aged individuals (35-64 years) constitute the largest proportion, while younger (16-24 years) and older (75+ years) groups have lower representation, with females slightly outnumbering males across most age groups. Employment Status (Employment) shows that females have a higher proportion in the employed category but also dominate in "looking after home/family" and "permanently unable to work" categories, reflecting gender differences in social roles. Vegetable (Veg) and Fruit (Fruit) consumption data reveal that most individuals report regular intake, with females exhibiting a higher proportion of consumption compared to males, potentially indicating gender-related differences in health behaviors. Sex (Sex) distribution suggests a slightly higher number of females than males in the dataset, though the overall distribution remains relatively balanced.
```{r}
#| echo: false
#| label: fig-variable-distribution
#| fig-cap: Distribution of Age Group, Employment Status, Vegetable Consumption, Fruit Consumption, and Sex by Gender in the Dataset.
#| fig-align: center
#| fig-width: 8
#| fig-height: 6

data <- read.csv("DAProject7.csv")

data <- data %>%
  mutate(Employment = case_when(
    Employment == "In paid employment, self-employed or on gov't training" ~ "Employed",
    Employment == "Looking for/intending to look for paid work" ~ "Unemployed",
    TRUE ~ Employment
  ))
p1 <- ggplot(data, aes(x = AgeGroup, fill = Sex)) +
  geom_bar(position = "dodge") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

p2 <- ggplot(data, aes(x = Sex, fill = Sex)) +
  geom_bar() +
  scale_fill_manual(values = c("Female" = "lightcoral", "Male" = "cyan3")) + 
  theme_minimal()

p3 <- ggplot(data, aes(x = Employment, fill = Sex)) +
  geom_bar(position = "dodge") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

p4 <- ggplot(data, aes(x = Veg, fill = Sex)) +
  geom_bar(position = "dodge") +
  theme_minimal()

p5 <- ggplot(data, aes(x = Fruit, fill = Sex)) +
  geom_bar(position = "dodge") +
  theme_minimal()

grid.arrange(
  p1, p2, p3, p4, p5,    
  layout_matrix = rbind(c(1, 2, 3), 
                        c(4, 5, 3)))

```        
## Obeaity changes over time (2008-2012)
@tbl-yearly-obesity-rate present the yearly obesity rates in Scotland between 2008 and 2012.Overall, the obesity rate dropped to its lowest point in 2009 (28.79%), and then rose sharply in 2010, reaching its highest point in five years (30.47%). After that, the obesity rate fell back and stabilized in 2011-2012. The data shows that there were some fluctuations in the obesity rate during this period, but it generally remained between 29% and 30.5%.
```{r}
#| echo: false
#| label: tbl-yearly-obesity-rate
#| tbl-cap: Yearly Obesity Rate in Scotland from 2008 to 2012.

yearly_rate <- data %>%
  group_by(Year) %>%
  summarise(ObesityRate = mean(Obese == "Yes") * 100)

yearly_rate %>%
  gt() %>%
  tab_header(title = "Yearly Obesity Rate (2008-2012)") %>%
  fmt_number(columns = ObesityRate, decimals = 2)
```  
##Obesity trend over time (2008-2012)
@fig-yearly-obesity shows the yearly trend of obesity rate in Scotland from 2008 to 2012.The trend shows that after the obesity rate fell in 2009, it rose significantly in 2010, and then gradually fell back and stabilized. The fluctuation in 2010 may reflect the increase in health risk factors that year, while the slowdown after 2011 may be related to health intervention measures and the improvement of awareness of physiological health management. Overall, the obesity rate shows periodic fluctuations, but remains at a relatively high level.

```{r}
#| echo: false
#| fig-cap: Yearly Obesity Rate Trend in Scotland (2008-2012)
#| label: fig-yearly-obesity
#| fig-align: center
#| fig-width: 6
#| fig-height: 4

ggplot(yearly_rate, aes(x = Year, y = ObesityRate)) +
  geom_line(color = "blue", linewidth = 1) +
  geom_point(color = "darkblue", size = 2) +
  labs(title = "Yearly Obesity Rate Trend (2008-2012)",
       y = "Obesity Rate (%)", x = "Year") +
  theme_minimal()
```
