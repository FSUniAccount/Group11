---
editor_options: 
  markdown: 
    wrap: 72
---

```{r}
library(readr) 
library(ggplot2) 
library(tidyverse) 
library(gt) 
library(patchwork) 
library(gridExtra) 
library(knitr) 
library(kableExtra) 
library(dplyr) 
library(broom) 
library(MASS) 
library(gt) 
library(caret) 
library(pROC) 
library(car) 
data <- read.csv("DAProject7.csv")
data$Obese <- ifelse(data$Obese =="Yes", 1, 0)

data$sex <- as.factor(data$Sex) 
data$employment <- as.factor(data$Employment) 
data$fruit <- as.factor(data$Fruit) 
data$veg <- as.factor(data$Veg)

model <- glm(Obese ~ Year + AgeGroup + Sex + Employment + Fruit + Veg, data = data, family = binomial)

summary(model)

plot(model)

predictions <- predict(model, type = "response")

data$predicted_prob <- predictions

head(data$predicted_prob)

AIC(model)

stepwise_model <- stepAIC(model, direction = "both", trace = 1) summary(stepwise_model)

odds_ratios <- exp(coef(stepwise_model)) conf_intervals <- exp(confint(stepwise_model))

odds_ratios conf_intervals

model_summary <- summary(stepwise_model) 
p_values <- model_summary$coefficients[, 4] p_values

odds_ratios_df <- data.frame( Variable = names(odds_ratios), 
                              OR = odds_ratios, 
                              LowerCI = conf_intervals[, 1], UpperCI = conf_intervals[, 2] )

odds_ratios_df <- odds_ratios_df %>% filter(Variable != "(Intercept)")

ggplot(odds_ratios_df, aes(x = Variable, y = OR, ymin = LowerCI, ymax = UpperCI)) + geom_pointrange() + # Points with lines for the CIs geom_hline(yintercept = 1, linetype = "dashed", color = "pink") + # Reference line at OR = 1 coord_flip() + # Flip the axes for better readability labs(x = "Variable", y = "Odds Ratio (95% CI)") + theme_minimal() + theme(axis.text.y = element_text(size = 12))
```

| Coefficients | Estimate | Std. Error | z value | Pr(\>\|z\|) |
|----|----|----|----|----|
| (Intercept) | -9.4455065 | 20.9773716 | -0.450 | 0.652515 |
| Year | 0.0040207 | 0.0104345 | 0.385 | 0.699993 |
| AgeGroup: 25-34 | 0.2905346 | 0.0792707 | 3.665 | 0.000247 \*\*\* |
| AgeGroup: 35-44 | 0.7118661 | 0.0755078 | 9.428 | \< 2e-16 \*\*\* |
| AgeGroup: 45-54 | 0.7732339 | 0.0752725 | 10.272 | \< 2e-16 \*\*\* |
| AgeGroup: 55-64 | 0.9751481 | 0.0771905 | 12.633 | \< 2e-16 \*\*\* |
| AgeGroup: 65-74 | 0.9536306 | 0.0898307 | 10.616 | \< 2e-16 \*\*\* |
| AgeGroup: 75+ | 0.6432094 | 0.0985387 | 6.527 | 6.69e-11 \*\*\* |
| SexMale | -0.0463063 | 0.0288692 | -1.604 | 0.108713 |
| Employment: In full-time education | -0.6499833 | 0.1710072 | -3.801 | 0.000144 \*\*\* |
| Employment: In paid employment, self-employed or on gov't training | -0.0172654 | 0.1353190 | -0.128 | 0.898473 |
| Employment: Looking after home/family | -0.0278140 | 0.1456978 | -0.191 | 0.848603 |
| Employment: Looking for/intending to look for paid work | 0.0009539 | 0.1574827 | 0.006 | 0.995167 |
| Employment: Perm unable to work | 0.2800048 | 0.1476789 | 1.896 | 0.057955 |
| Employment: Retired | 0.0006616 | 0.1418566 | 0.005 | 0.996279 |
| Fruit: Yes | -0.0316488 | 0.0316202 | -1.001 | 0.316873 |
| Veg: Yes | -0.1930594 | 0.0342967 | -5.629 | 1.81e-08 \*\*\* |
